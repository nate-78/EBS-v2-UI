---
import Layout from '../../layouts/Layout.astro';
import { clients } from '../../data-test/dashboard.json';
import { taxYears } from '../../data-test/tax-years.json';
import ClientSubmissions from '../../components/ClientSubmissions.astro';

export async function getStaticPaths() {
  
  // get the most recent tax year
  const activeYear = taxYears ? taxYears[0] : 0;

  const paths = taxYears.map((year) => {
    // NOTE: In the future, this is where you'd call the API for year-specific data
    // const clientData = await fetchClientsForYear(year);
    
    return {
      params: { 
        'tax-year': String(year) // Must be a string for URL segments
      },
      // For this example, we'll just pass the whole dataset for any year, 
      // but in a real app, this would be the data for the requested year.
      props: { 
        dashboardData: clients,
        taxYear: year 
      }
    };
  });

  // --- 2. Add the base /dashboard path ---
  // This handles the case where the user navigates to /dashboard
  paths.push({
    params: { 
      'tax-year': undefined // No path segment for the year
    },
    props: { 
      dashboardData: clients,
      taxYear: activeYear // Default to the most recent year's data
    }
  });

  return paths;
}

// --- Get the entries and year for the current page ---
const { dashboardData, taxYear } = Astro.props;
---

<Layout>
  <div class="container">
    <div class="tax-years">
      <ul>
        {
          taxYears.map((yr) => (
            <li><a href={`/dashboard/${yr}`}>{yr}</a></li>
          ))
        }
      </ul>
    </div>
    <div class="submissions">
      <h1>ACA Submissions</h1>
      {
        dashboardData.map((client) => (
          <ClientSubmissions client={client} />
        ))
      }
    </div>
    <div class="actions">

    </div>
  </div>
</Layout>


<style>
  .container {
    display: grid;
    grid-template-columns: 1fr 3fr 1fr;
    gap: 1rem;
  }
</style>